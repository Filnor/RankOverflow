$("#id").on("input",function(){validateForm()});function calculateRank(){if(!validateForm()){return}var userId=parseInt($("#id").val().match(/https:\/\/stackoverflow\.com\/users\/\d+/)[0].split("/")[4]);$(".loader").removeClass("hidden");$("#rank-status").html("Your ranks are getting calculated, please wait...");$(".col-xs-12.card-margin").addClass("hidden");var promise=new Promise(getAllRanks(userId));promise.then(function(){}).catch(function(e){alert(e)})}function validateForm(){$("#id").val().match(/https:\/\/stackoverflow\.com\/users\/\d+/g);if($("#id").val()!==""&&$("#id").val().match(/https:\/\/stackoverflow\.com\/users\/\d+/)!==null){$("#id").removeClass("invalid");$("#idError").removeClass("display");return true}else{$("#id").addClass("invalid");$("#idError").addClass("display");return false}}function getRank(id,fetchMode){fetch("api/getUserRankLastPage.php",{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},body:"userid="+id+"&mode="+fetchMode}).then(function(resp){return resp.text()}).then(function(data){$("#rank-results").html(data);var userRank=$($($(".highlight").children()[2]).children()[0]).children()[0].innerText.substr(1);var maxPage=$("[rel='next']").parent().children()[$("[rel='next']").parent().children().length-2].innerText;$("#rank-results").html("");fetch("api/getLastRank.php",{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded; charset=UTF-8"},body:"mode="+fetchMode+"&page="+maxPage}).then(function(resp){return resp.text()}).then(function(data){$("#rank-results").html(data);var lastRank=$($(".league-container").last().children()[2]).children().first().children()[0].innerText.substr(1);$("#rank-results").html("");$(".loader").addClass("hidden");$("#rank-status").html("These are your ranks:");var share=userRank/lastRank;var percentageExact=share*100;var percentage=percentageExact>1?Math.ceil(percentageExact):Math.ceil(percentageExact*100)/100;$(".rank-"+fetchMode).first().parent().parent().parent().removeClass("hidden");$(".rank-"+fetchMode).html(percentage);$(".rank-exact-"+fetchMode).html(percentageExact)}).catch(function(e){})}).catch(function(e){})}function getAllRanks(id){return function(resolve,reject){try{getRank(id,"week");getRank(id,"month");getRank(id,"quarter");getRank(id,"year");getRank(id,"alltime");resolve()}catch(e){reject(e)}}}